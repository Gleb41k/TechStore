<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <title>TechStore | Telegram Mini App</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    /* Оптимизация для Telegram Mini App */
    :root {
      --tg-theme-bg-color: #0f172a;
      --tg-theme-text-color: #f1f5f9;
      --tg-theme-hint-color: #94a3b8;
      --tg-theme-link-color: #7c3aed;
      --tg-theme-button-color: #7c3aed;
      --tg-theme-button-text-color: #ffffff;
      --tg-theme-secondary-bg-color: #1e293b;
      --primary: #7c3aed;
      --primary-dark: #5b21b6;
      --secondary: #0ea5e9;
      --accent: #f59e0b;
      --success: #10b981;
      --danger: #ef4444;
      --border: #475569;
      --card-radius: 16px;
      --shadow: rgba(0, 0, 0, 0.3);
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      -webkit-tap-highlight-color: transparent;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      background: var(--tg-theme-bg-color, #0f172a);
      color: var(--tg-theme-text-color, #f1f5f9);
      line-height: 1.5;
      min-height: 100vh;
      padding-bottom: 80px;
    }

    /* Заголовок для Telegram */
    .tg-header {
      background: var(--tg-theme-secondary-bg-color, #1e293b);
      padding: 16px 20px;
      position: sticky;
      top: 0;
      z-index: 100;
      display: flex;
      align-items: center;
      justify-content: space-between;
      border-bottom: 1px solid var(--border);
      backdrop-filter: blur(10px);
    }

    .tg-header .logo {
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 1.5rem;
      font-weight: 700;
    }

    .tg-header .logo i {
      color: var(--primary);
    }

    .tg-header .logo span {
      background: linear-gradient(90deg, var(--primary), var(--secondary));
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
    }

    .tg-header .user-actions {
      display: flex;
      gap: 12px;
      align-items: center;
    }

    .icon-btn {
      background: none;
      border: none;
      color: var(--tg-theme-text-color);
      font-size: 1.3rem;
      padding: 8px;
      position: relative;
      cursor: pointer;
    }

    .badge {
      position: absolute;
      top: -5px;
      right: -5px;
      background: var(--primary);
      color: white;
      font-size: 0.7rem;
      width: 18px;
      height: 18px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    /* Основной контент */
    .container {
      padding: 0 16px;
      max-width: 100%;
    }

    /* Категории */
    .categories {
      padding: 20px 0;
      overflow-x: auto;
      display: flex;
      gap: 10px;
      -webkit-overflow-scrolling: touch;
      scrollbar-width: none;
    }

    .categories::-webkit-scrollbar {
      display: none;
    }

    .category-btn {
      flex-shrink: 0;
      padding: 10px 20px;
      background: var(--tg-theme-secondary-bg-color);
      border: 1px solid var(--border);
      border-radius: 25px;
      color: var(--tg-theme-text-color);
      font-weight: 500;
      transition: all 0.2s;
      white-space: nowrap;
      cursor: pointer;
    }

    .category-btn.active {
      background: var(--primary);
      color: white;
      border-color: var(--primary);
    }

    /* Карточки товаров */
    .products-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
      gap: 16px;
      margin-top: 10px;
    }

    .product-card {
      background: var(--tg-theme-secondary-bg-color);
      border-radius: var(--card-radius);
      overflow: hidden;
      transition: transform 0.2s;
      border: 1px solid var(--border);
      position: relative;
    }

    .product-card:active {
      transform: scale(0.98);
    }

    .product-image {
      height: 140px;
      overflow: hidden;
      position: relative;
    }

    .product-image img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .product-badge {
      position: absolute;
      top: 10px;
      left: 10px;
      background: var(--primary);
      color: white;
      padding: 4px 8px;
      border-radius: 12px;
      font-size: 0.7rem;
      font-weight: 600;
    }

    .favorite-btn {
      position: absolute;
      top: 10px;
      right: 10px;
      background: rgba(0, 0, 0, 0.6);
      border: none;
      color: white;
      width: 36px;
      height: 36px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.3s;
      backdrop-filter: blur(4px);
    }

    .favorite-btn.active {
      background: var(--danger);
      color: white;
    }

    .favorite-btn:hover {
      transform: scale(1.1);
    }

    .product-content {
      padding: 12px;
    }

    .product-title {
      font-size: 0.95rem;
      font-weight: 600;
      margin-bottom: 5px;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    .product-price {
      font-size: 1.2rem;
      font-weight: 700;
      color: var(--accent);
      margin: 8px 0;
    }

    .product-rating {
      display: flex;
      align-items: center;
      gap: 5px;
      color: #fbbf24;
      font-size: 0.8rem;
      margin-bottom: 8px;
    }

    .add-to-cart-btn {
      width: 100%;
      padding: 10px;
      background: var(--primary);
      color: white;
      border: none;
      border-radius: 10px;
      font-weight: 600;
      font-size: 0.9rem;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      transition: opacity 0.2s;
      cursor: pointer;
    }

    .add-to-cart-btn:active {
      opacity: 0.8;
    }

    /* Детальная страница товара */
    .product-detail {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: var(--tg-theme-bg-color);
      z-index: 1000;
      overflow-y: auto;
      display: none;
    }

    .product-detail.active {
      display: block;
    }

    .detail-header {
      position: sticky;
      top: 0;
      background: var(--tg-theme-bg-color);
      padding: 16px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      border-bottom: 1px solid var(--border);
      z-index: 10;
    }

    .back-btn {
      background: none;
      border: none;
      color: var(--tg-theme-text-color);
      font-size: 1.2rem;
      padding: 8px;
      cursor: pointer;
    }

    .detail-image {
      height: 300px;
      overflow: hidden;
    }

    .detail-image img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .detail-content {
      padding: 20px;
    }

    .detail-title {
      font-size: 1.5rem;
      font-weight: 700;
      margin-bottom: 10px;
    }

    .detail-price {
      font-size: 2rem;
      font-weight: 700;
      color: var(--accent);
      margin-bottom: 15px;
    }

    .detail-description {
      color: var(--tg-theme-hint-color);
      line-height: 1.6;
      margin-bottom: 25px;
    }

    .specs-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 15px;
      margin-bottom: 25px;
    }

    .spec-item {
      background: var(--tg-theme-secondary-bg-color);
      padding: 15px;
      border-radius: 12px;
    }

    .spec-label {
      font-size: 0.8rem;
      color: var(--tg-theme-hint-color);
      margin-bottom: 5px;
    }

    .spec-value {
      font-weight: 600;
      font-size: 1rem;
    }

    .detail-actions {
      position: sticky;
      bottom: 0;
      background: var(--tg-theme-bg-color);
      padding: 16px;
      border-top: 1px solid var(--border);
      display: flex;
      gap: 12px;
    }

    .buy-btn {
      flex: 1;
      padding: 16px;
      background: var(--primary);
      color: white;
      border: none;
      border-radius: 12px;
      font-weight: 600;
      font-size: 1rem;
      cursor: pointer;
    }

    .cart-btn-big {
      width: 50px;
      background: var(--tg-theme-secondary-bg-color);
      color: var(--tg-theme-text-color);
      border: none;
      border-radius: 12px;
      font-size: 1.2rem;
      cursor: pointer;
    }

    /* Страницы избранного и профиля */
    .page {
      display: none;
      animation: fadeIn 0.3s ease;
    }

    .page.active {
      display: block;
    }

    .page-header {
      padding: 20px;
      text-align: center;
      background: var(--tg-theme-secondary-bg-color);
      margin-bottom: 20px;
      border-radius: 0 0 20px 20px;
    }

    .page-header h1 {
      font-size: 1.8rem;
      margin-bottom: 10px;
    }

    .page-header p {
      color: var(--tg-theme-hint-color);
    }

    .favorites-empty, .profile-section {
      text-align: center;
      padding: 40px 20px;
    }

    .favorites-empty i, .profile-section i {
      font-size: 4rem;
      color: var(--tg-theme-hint-color);
      margin-bottom: 20px;
    }

    .profile-card {
      background: var(--tg-theme-secondary-bg-color);
      border-radius: var(--card-radius);
      padding: 25px;
      margin: 20px;
      text-align: center;
      border: 1px solid var(--border);
    }

    .profile-avatar {
      width: 100px;
      height: 100px;
      border-radius: 50%;
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      margin: 0 auto 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2.5rem;
      color: white;
    }

    .profile-name {
      font-size: 1.5rem;
      font-weight: 700;
      margin-bottom: 5px;
    }

    .profile-email {
      color: var(--tg-theme-hint-color);
      margin-bottom: 20px;
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 15px;
      margin: 25px 0;
    }

    .stat-item {
      background: var(--tg-theme-bg-color);
      padding: 15px;
      border-radius: 12px;
      text-align: center;
    }

    .stat-value {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--accent);
    }

    .stat-label {
      font-size: 0.8rem;
      color: var(--tg-theme-hint-color);
      margin-top: 5px;
    }

    .profile-menu {
      margin: 20px;
    }

    .menu-item {
      display: flex;
      align-items: center;
      gap: 15px;
      padding: 18px;
      background: var(--tg-theme-secondary-bg-color);
      border-radius: 12px;
      margin-bottom: 10px;
      border: 1px solid var(--border);
      cursor: pointer;
      transition: all 0.2s;
    }

    .menu-item:hover {
      transform: translateX(5px);
      border-color: var(--primary);
    }

    .menu-item i {
      font-size: 1.2rem;
      width: 24px;
      text-align: center;
    }

    .menu-item-content {
      flex: 1;
    }

    .menu-item-title {
      font-weight: 600;
      margin-bottom: 3px;
    }

    .menu-item-desc {
      font-size: 0.8rem;
      color: var(--tg-theme-hint-color);
    }

    /* Корзина */
    .cart-panel {
      position: fixed;
      top: 0;
      right: -100%;
      width: 100%;
      height: 100%;
      background: var(--tg-theme-bg-color);
      z-index: 2000;
      transition: right 0.3s;
      overflow-y: auto;
    }

    .cart-panel.active {
      right: 0;
    }

    .cart-header {
      padding: 20px;
      border-bottom: 1px solid var(--border);
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .cart-items {
      padding: 20px;
    }

    .cart-item {
      display: flex;
      gap: 15px;
      padding: 15px;
      background: var(--tg-theme-secondary-bg-color);
      border-radius: 12px;
      margin-bottom: 15px;
    }

    .cart-item-image {
      width: 80px;
      height: 80px;
      border-radius: 10px;
      overflow: hidden;
    }

    .cart-item-image img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .cart-item-content {
      flex: 1;
    }

    .cart-item-title {
      font-weight: 600;
      margin-bottom: 5px;
    }

    .cart-item-price {
      color: var(--accent);
      font-weight: 600;
    }

    .cart-item-actions {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-top: 10px;
    }

    .quantity-btn {
      width: 30px;
      height: 30px;
      background: var(--border);
      border: none;
      border-radius: 50%;
      color: var(--tg-theme-text-color);
      font-size: 1.2rem;
      cursor: pointer;
    }

    .quantity {
      font-weight: 600;
      min-width: 30px;
      text-align: center;
    }

    .cart-total {
      padding: 20px;
      border-top: 1px solid var(--border);
      position: sticky;
      bottom: 0;
      background: var(--tg-theme-bg-color);
    }

    .total-row {
      display: flex;
      justify-content: space-between;
      margin-bottom: 10px;
    }

    .checkout-btn {
      width: 100%;
      padding: 16px;
      background: var(--primary);
      color: white;
      border: none;
      border-radius: 12px;
      font-weight: 600;
      font-size: 1rem;
      margin-top: 15px;
      cursor: pointer;
    }

    /* Нижнее меню */
    .bottom-nav {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: var(--tg-theme-secondary-bg-color);
      display: flex;
      justify-content: space-around;
      padding: 12px 0;
      border-top: 1px solid var(--border);
      z-index: 100;
    }

    .nav-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      color: var(--tg-theme-hint-color);
      font-size: 0.8rem;
      gap: 5px;
      padding: 8px 16px;
      border-radius: 12px;
      transition: all 0.2s;
      text-decoration: none;
      cursor: pointer;
    }

    .nav-item.active {
      color: var(--primary);
      background: rgba(124, 58, 237, 0.1);
    }

    .nav-item i {
      font-size: 1.2rem;
    }

    /* Адаптивность */
    @media (min-width: 768px) {
      .container {
        max-width: 768px;
        margin: 0 auto;
      }

      .products-grid {
        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      }

      .cart-panel {
        width: 400px;
      }

      .page-header {
        margin: 0 20px 20px;
      }
    }

    /* Анимации */
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    .fade-in {
      animation: fadeIn 0.3s ease;
    }

    /* Скелетон загрузки */
    .skeleton {
      background: linear-gradient(90deg, #1e293b 25%, #2d3748 50%, #1e293b 75%);
      background-size: 200% 100%;
      animation: loading 1.5s infinite;
      border-radius: 8px;
    }

    @keyframes loading {
      0% { background-position: 200% 0; }
      100% { background-position: -200% 0; }
    }
  </style>
</head>
<body>
  <!-- Шапка Telegram -->
  <div class="tg-header">
    <div class="logo" id="homeButton">
      <i class="fas fa-laptop-code"></i>
      <span>TechStore</span>
    </div>
    <div class="user-actions">
      <button class="icon-btn" id="favoritesButton">
        <i class="fas fa-heart"></i>
        <span class="badge" id="favoritesCount">0</span>
      </button>
      <button class="icon-btn" id="cartButton">
        <i class="fas fa-shopping-cart"></i>
        <span class="badge" id="cartCount">0</span>
      </button>
      <button class="icon-btn" id="profileButton">
        <i class="fas fa-user"></i>
      </button>
    </div>
  </div>

  <!-- Главная страница -->
  <div class="page active" id="homePage">
    <div class="container">
      <!-- Категории -->
      <div class="categories">
        <button class="category-btn active" data-category="all">Все</button>
        <button class="category-btn" data-category="phones">Смартфоны</button>
        <button class="category-btn" data-category="laptops">Ноутбуки</button>
        <button class="category-btn" data-category="audio">Аудио</button>
        <button class="category-btn" data-category="accessories">Аксессуары</button>
      </div>

      <!-- Сетка товаров -->
      <div class="products-grid" id="productsGrid">
        <!-- Товары будут загружены через JavaScript -->
      </div>
    </div>
  </div>

  <!-- Страница избранного -->
  <div class="page" id="favoritesPage">
    <div class="page-header">
      <h1><i class="fas fa-heart"></i> Избранное</h1>
      <p>Ваши любимые товары</p>
    </div>

    <div class="container">
      <div class="products-grid" id="favoritesGrid">
        <!-- Избранные товары будут загружены динамически -->
      </div>

      <div class="favorites-empty" id="favoritesEmpty" style="display: none;">
        <i class="fas fa-heart-broken"></i>
        <h3>В избранном пока ничего нет</h3>
        <p style="color: var(--tg-theme-hint-color); margin-top: 10px;">
          Добавляйте товары в избранное, нажимая на сердечко
        </p>
        <button class="add-to-cart-btn" style="margin-top: 20px; width: auto; padding: 12px 24px;" id="goToHomeFromFav">
          <i class="fas fa-store"></i> Перейти в магазин
        </button>
      </div>
    </div>
  </div>

  <!-- Страница профиля -->
  <div class="page" id="profilePage">
    <div class="page-header">
      <h1><i class="fas fa-user-circle"></i> Профиль</h1>
      <p>Управление аккаунтом и настройки</p>
    </div>

    <div class="profile-card">
      <div class="profile-avatar">
        <i class="fas fa-user"></i>
      </div>
      <div class="profile-name" id="userName">Александр Петров</div>
      <div class="profile-email" id="userEmail">alex@example.com</div>
      <div class="profile-balance" style="color: var(--accent); font-size: 1.2rem; font-weight: 600;">
        Баланс: <span id="userBalance">15 840 ₽</span>
      </div>
    </div>

    <div class="stats-grid">
      <div class="stat-item">
        <div class="stat-value" id="ordersCount">12</div>
        <div class="stat-label">Заказов</div>
      </div>
      <div class="stat-item">
        <div class="stat-value" id="favoritesStat">8</div>
        <div class="stat-label">Избранное</div>
      </div>
      <div class="stat-item">
        <div class="stat-value" id="cartItemsCount">3</div>
        <div class="stat-label">В корзине</div>
      </div>
    </div>

    <div class="profile-menu">
      <div class="menu-item" id="ordersMenuItem">
        <i class="fas fa-box-open" style="color: var(--primary);"></i>
        <div class="menu-item-content">
          <div class="menu-item-title">Мои заказы</div>
          <div class="menu-item-desc">История и статус заказов</div>
        </div>
        <i class="fas fa-chevron-right"></i>
      </div>

      <div class="menu-item" id="addressesMenuItem">
        <i class="fas fa-map-marker-alt" style="color: var(--success);"></i>
        <div class="menu-item-content">
          <div class="menu-item-title">Адреса доставки</div>
          <div class="menu-item-desc">Управление адресами</div>
        </div>
        <i class="fas fa-chevron-right"></i>
      </div>

      <div class="menu-item" id="paymentMenuItem">
        <i class="fas fa-credit-card" style="color: var(--accent);"></i>
        <div class="menu-item-content">
          <div class="menu-item-title">Способы оплаты</div>
          <div class="menu-item-desc">Карты и платежные системы</div>
        </div>
        <i class="fas fa-chevron-right"></i>
      </div>

      <div class="menu-item" id="settingsMenuItem">
        <i class="fas fa-cog" style="color: var(--secondary);"></i>
        <div class="menu-item-content">
          <div class="menu-item-title">Настройки</div>
          <div class="menu-item-desc">Уведомления и конфиденциальность</div>
        </div>
        <i class="fas fa-chevron-right"></i>
      </div>

      <div class="menu-item" id="supportMenuItem">
        <i class="fas fa-headset" style="color: var(--danger);"></i>
        <div class="menu-item-content">
          <div class="menu-item-title">Поддержка</div>
          <div class="menu-item-desc">Помощь и обратная связь</div>
        </div>
        <i class="fas fa-chevron-right"></i>
      </div>
    </div>
  </div>

  <!-- Детальная страница товара -->
  <div class="product-detail" id="productDetail">
    <div class="detail-header">
      <button class="back-btn" id="backButton">
        <i class="fas fa-arrow-left"></i>
      </button>
      <button class="icon-btn" id="detailFavoriteButton">
        <i class="fas fa-heart"></i>
      </button>
      <button class="icon-btn" id="detailCartButton">
        <i class="fas fa-shopping-cart"></i>
        <span class="badge" id="detailCartCount">0</span>
      </button>
    </div>

    <div class="detail-image" id="detailImage">
      <!-- Изображение будет загружено динамически -->
    </div>

    <div class="detail-content">
      <h1 class="detail-title" id="detailTitle"></h1>
      <div class="detail-price" id="detailPrice"></div>
      <p class="detail-description" id="detailDescription"></p>

      <div class="specs-grid" id="specsGrid">
        <!-- Характеристики будут загружены динамически -->
      </div>
    </div>

    <div class="detail-actions">
      <button class="buy-btn" id="buyButton">
        <i class="fas fa-bolt"></i> Купить сейчас
      </button>
      <button class="cart-btn-big" id="addToCartDetail">
        <i class="fas fa-cart-plus"></i>
      </button>
    </div>
  </div>

  <!-- Панель корзины -->
  <div class="cart-panel" id="cartPanel">
    <div class="cart-header">
      <h2>Корзина</h2>
      <button class="back-btn" id="closeCartButton">
        <i class="fas fa-times"></i>
      </button>
    </div>

    <div class="cart-items" id="cartItems">
      <!-- Товары в корзине будут загружены динамически -->
    </div>

    <div class="cart-total">
      <div class="total-row">
        <span>Товары:</span>
        <span id="subtotal">0 ₽</span>
      </div>
      <div class="total-row">
        <span>Доставка:</span>
        <span>Бесплатно</span>
      </div>
      <div class="total-row" style="font-weight: 700; font-size: 1.2rem;">
        <span>Итого:</span>
        <span id="total">0 ₽</span>
      </div>
      <button class="checkout-btn" id="checkoutButton">
        <i class="fas fa-lock"></i> Перейти к оплате
      </button>
    </div>
  </div>

  <!-- Нижнее меню -->
  <div class="bottom-nav">
    <a href="#" class="nav-item active" data-page="home">
      <i class="fas fa-home"></i>
      <span>Главная</span>
    </a>
    <a href="#" class="nav-item" data-page="favorites">
      <i class="fas fa-heart"></i>
      <span>Избранное</span>
    </a>
    <a href="#" class="nav-item" data-page="profile">
      <i class="fas fa-user"></i>
      <span>Профиль</span>
    </a>
  </div>

  <script>
    // Telegram WebApp инициализация
    let tg = window.Telegram?.WebApp;

    if (tg) {
      tg.expand();
      tg.enableClosingConfirmation();
      tg.BackButton.onClick(() => {
        if (document.getElementById('productDetail').classList.contains('active')) {
          closeProductDetail();
        } else if (document.getElementById('cartPanel').classList.contains('active')) {
          closeCart();
        } else if (!document.getElementById('homePage').classList.contains('active')) {
          showPage('home');
        }
      });
    }

    // Данные товаров
    let products = [
      {
        id: 1,
        name: "iPhone 15 Pro",
        price: 99990,
        category: "phones",
        image: "https://images.unsplash.com/photo-1695048133142-1a20484d2569?w=400&h=400&fit=crop",
        rating: 4.8,
        description: "Флагманский смартфон с чипом A17 Pro, камерой 48 МП и титановым корпусом.",
        specs: {
          "Процессор": "Apple A17 Pro",
          "Память": "256 ГБ",
          "Экран": "6.1\" Super Retina XDR",
          "Камера": "48 МП + 12 МП + 12 МП",
          "Батарея": "3274 mAh"
        }
      },
      {
        id: 2,
        name: "Samsung Galaxy S24",
        price: 84990,
        category: "phones",
        image: "https://images.unsplash.com/photo-1610945265064-0e34e5519bbf?w=400&h=400&fit=crop",
        rating: 4.7,
        description: "Инновационный смартфон с искусственным интеллектом и продвинутой камерой.",
        specs: {
          "Процессор": "Snapdragon 8 Gen 3",
          "Память": "256 ГБ",
          "Экран": "6.2\" Dynamic AMOLED",
          "Камера": "50 МП + 12 МП + 10 МП",
          "Батарея": "4000 mAh"
        }
      },
      {
        id: 3,
        name: "Xiaomi 14 Pro",
        price: 69990,
        category: "phones",
        image: "https://images.unsplash.com/photo-1598327105666-5b89351aff97?w=400&h=400&fit=crop",
        rating: 4.6,
        description: "Мощный смартфон с камерой Leica и быстрой зарядкой 120W.",
        specs: {
          "Процессор": "Snapdragon 8 Gen 2",
          "Память": "512 ГБ",
          "Экран": "6.73\" AMOLED",
          "Камера": "50 МП Leica",
          "Батарея": "4880 mAh"
        }
      },
      {
        id: 4,
        name: "MacBook Air M3",
        price: 129990,
        category: "laptops",
        image: "https://images.unsplash.com/photo-1541807084-5c52b6b3adef?w=400&h=400&fit=crop",
        rating: 4.9,
        description: "Ультратонкий ноутбук с чипом Apple M3, экраном Liquid Retina.",
        specs: {
          "Процессор": "Apple M3",
          "Память": "16 ГБ / 512 ГБ",
          "Экран": "13.6\" Liquid Retina",
          "Батарея": "до 18 часов",
          "Вес": "1.24 кг"
        }
      },
      {
        id: 5,
        name: "Dell XPS 13",
        price: 109990,
        category: "laptops",
        image: "https://images.unsplash.com/photo-1593640408182-31c70c8268f5?w=400&h=400&fit=crop",
        rating: 4.7,
        description: "Премиальный ультрабук с безрамочным дисплеем и мощным процессором.",
        specs: {
          "Процессор": "Intel Core i7",
          "Память": "16 ГБ / 1 ТБ",
          "Экран": "13.4\" 4K UHD",
          "Батарея": "до 14 часов",
          "Вес": "1.27 кг"
        }
      },
      {
        id: 6,
        name: "Sony WH-1000XM5",
        price: 34990,
        category: "audio",
        image: "https://images.unsplash.com/photo-1505740420928-5e560c06d30e?w=400&h=400&fit=crop",
        rating: 4.8,
        description: "Беспроводные наушники с лучшим в мире шумоподавлением.",
        specs: {
          "Тип": "Накладные",
          "Шумоподавление": "Адаптивное",
          "Время работы": "до 30 часов",
          "Вес": "250 г",
          "Bluetooth": "5.2"
        }
      },
      {
        id: 7,
        name: "Apple Watch Series 9",
        price: 44990,
        category: "accessories",
        image: "https://images.unsplash.com/photo-1551816230-ef5deaed4a26?w=400&h=400&fit=crop",
        rating: 4.7,
        description: "Умные часы с функцией двойного нажатия и чипом S9.",
        specs: {
          "Экран": "Always-On Retina",
          "Процессор": "Apple S9",
          "Память": "64 ГБ",
          "Водозащита": "WR50",
          "Батарея": "до 18 часов"
        }
      },
      {
        id: 8,
        name: "AirPods Pro 2",
        price: 24990,
        category: "audio",
        image: "https://images.unsplash.com/photo-1599660663230-2c4e4faa6c5c?w=400&h=400&fit=crop",
        rating: 4.7,
        description: "Наушники с адаптивным шумоподавлением и пространственным аудио.",
        specs: {
          "Тип": "Вкладыши",
          "Шумоподавление": "Адаптивное",
          "Время работы": "до 6 часов",
          "Вес": "5.3 г (каждый)",
          "Зарядка": "MagSafe"
        }
      }
    ];

    let cart = JSON.parse(localStorage.getItem('techstore_cart')) || [];
    let favorites = JSON.parse(localStorage.getItem('techstore_favorites')) || [];
    let currentCategory = 'all';

    // Функции для работы со страницами
    function showPage(pageId) {
      // Скрываем все страницы
      document.querySelectorAll('.page').forEach(page => {
        page.classList.remove('active');
      });

      // Показываем нужную страницу
      document.getElementById(pageId + 'Page').classList.add('active');

      // Обновляем нижнее меню
      document.querySelectorAll('.nav-item').forEach(item => {
        item.classList.remove('active');
        if (item.dataset.page === pageId) {
          item.classList.add('active');
        }
      });

      // Обновляем контент страницы
      if (pageId === 'home') {
        renderProducts();
      } else if (pageId === 'favorites') {
        renderFavorites();
        updateProfileStats();
      } else if (pageId === 'profile') {
        updateProfileStats();
      }

      // Управление кнопкой "Назад" в Telegram
      if (tg) {
        if (pageId === 'home') {
          tg.BackButton.hide();
        } else {
          tg.BackButton.show();
        }
      }
    }

    // Функция рендеринга товаров
    function renderProducts() {
      const grid = document.getElementById('productsGrid');
      grid.innerHTML = '';

      const filteredProducts = currentCategory === 'all'
        ? products
        : products.filter(p => p.category === currentCategory);

      if (filteredProducts.length === 0) {
        grid.innerHTML = `
          <div style="grid-column: 1/-1; text-align: center; padding: 40px 20px; color: var(--tg-theme-hint-color);">
            <i class="fas fa-box-open" style="font-size: 3rem; margin-bottom: 20px;"></i>
            <p>Товары не найдены</p>
          </div>
        `;
        return;
      }

      filteredProducts.forEach(product => {
        const isFavorite = favorites.includes(product.id);

        const card = document.createElement('div');
        card.className = 'product-card fade-in';
        card.innerHTML = `
          <div class="product-image">
            <img src="${product.image}" alt="${product.name}" loading="lazy">
            <div class="product-badge">-10%</div>
            <button class="favorite-btn ${isFavorite ? 'active' : ''}" data-id="${product.id}">
              <i class="fas fa-heart"></i>
            </button>
          </div>
          <div class="product-content">
            <h3 class="product-title">${product.name}</h3>
            <div class="product-rating">
              <i class="fas fa-star"></i>
              <span>${product.rating}</span>
            </div>
            <div class="product-price">${product.price.toLocaleString()} ₽</div>
            <button class="add-to-cart-btn" data-id="${product.id}">
              <i class="fas fa-cart-plus"></i> В корзину
            </button>
          </div>
        `;

        card.addEventListener('click', (e) => {
          if (!e.target.closest('.favorite-btn') && !e.target.closest('.add-to-cart-btn')) {
            showProductDetail(product.id);
          }
        });

        grid.appendChild(card);
      });

      // Добавляем обработчики для кнопок
      document.querySelectorAll('.add-to-cart-btn').forEach(btn => {
        btn.addEventListener('click', (e) => {
          e.stopPropagation();
          const productId = parseInt(btn.dataset.id);
          addToCart(productId);
        });
      });

      document.querySelectorAll('.favorite-btn').forEach(btn => {
        btn.addEventListener('click', (e) => {
          e.stopPropagation();
          const productId = parseInt(btn.dataset.id);
          toggleFavorite(productId);
        });
      });
    }

    // Функция рендеринга избранного
    function renderFavorites() {
      const grid = document.getElementById('favoritesGrid');
      const emptyState = document.getElementById('favoritesEmpty');

      grid.innerHTML = '';

      if (favorites.length === 0) {
        grid.style.display = 'none';
        emptyState.style.display = 'block';
        return;
      }

      grid.style.display = 'grid';
      emptyState.style.display = 'none';

      favorites.forEach(favId => {
        const product = products.find(p => p.id === favId);
        if (!product) return;

        const card = document.createElement('div');
        card.className = 'product-card fade-in';
        card.innerHTML = `
          <div class="product-image">
            <img src="${product.image}" alt="${product.name}" loading="lazy">
            <div class="product-badge">-10%</div>
            <button class="favorite-btn active" data-id="${product.id}">
              <i class="fas fa-heart"></i>
            </button>
          </div>
          <div class="product-content">
            <h3 class="product-title">${product.name}</h3>
            <div class="product-rating">
              <i class="fas fa-star"></i>
              <span>${product.rating}</span>
            </div>
            <div class="product-price">${product.price.toLocaleString()} ₽</div>
            <button class="add-to-cart-btn" data-id="${product.id}">
              <i class="fas fa-cart-plus"></i> В корзину
            </button>
          </div>
        `;

        card.addEventListener('click', (e) => {
          if (!e.target.closest('.favorite-btn') && !e.target.closest('.add-to-cart-btn')) {
            showProductDetail(product.id);
          }
        });

        grid.appendChild(card);
      });

      // Добавляем обработчики для кнопок
      document.querySelectorAll('.add-to-cart-btn').forEach(btn => {
        btn.addEventListener('click', (e) => {
          e.stopPropagation();
          const productId = parseInt(btn.dataset.id);
          addToCart(productId);
        });
      });

      document.querySelectorAll('.favorite-btn').forEach(btn => {
        btn.addEventListener('click', (e) => {
          e.stopPropagation();
          const productId = parseInt(btn.dataset.id);
          toggleFavorite(productId);
        });
      });
    }

    // Функция обновления статистики профиля
    function updateProfileStats() {
      document.getElementById('favoritesStat').textContent = favorites.length;
      document.getElementById('cartItemsCount').textContent = cart.reduce((sum, item) => sum + item.quantity, 0);

      // Обновляем счетчик избранного в шапке
      document.getElementById('favoritesCount').textContent = favorites.length;
    }

    // Функция показа деталей товара
    function showProductDetail(productId) {
      const product = products.find(p => p.id === productId);
      if (!product) return;

      const isFavorite = favorites.includes(productId);

      document.getElementById('detailTitle').textContent = product.name;
      document.getElementById('detailPrice').textContent = `${product.price.toLocaleString()} ₽`;
      document.getElementById('detailDescription').textContent = product.description;

      document.getElementById('detailImage').innerHTML = `
        <img src="${product.image}" alt="${product.name}">
      `;

      // Настраиваем кнопку избранного
      const favBtn = document.getElementById('detailFavoriteButton');
      favBtn.innerHTML = `<i class="fas fa-heart ${isFavorite ? 'active' : ''}"></i>`;
      favBtn.querySelector('i').style.color = isFavorite ? 'var(--danger)' : '';

      const specsGrid = document.getElementById('specsGrid');
      specsGrid.innerHTML = '';

      for (const [key, value] of Object.entries(product.specs)) {
        const specItem = document.createElement('div');
        specItem.className = 'spec-item';
        specItem.innerHTML = `
          <div class="spec-label">${key}</div>
          <div class="spec-value">${value}</div>
        `;
        specsGrid.appendChild(specItem);
      }

      document.getElementById('productDetail').classList.add('active');

      if (tg) {
        tg.BackButton.show();
      }

      // Назначаем обработчики для кнопок в деталях
      document.getElementById('addToCartDetail').onclick = () => addToCart(productId);
      document.getElementById('buyButton').onclick = () => {
        addToCart(productId);
        openCart();
      };
      document.getElementById('detailFavoriteButton').onclick = () => {
        toggleFavorite(productId);
        const newIsFavorite = favorites.includes(productId);
        favBtn.innerHTML = `<i class="fas fa-heart ${newIsFavorite ? 'active' : ''}"></i>`;
        favBtn.querySelector('i').style.color = newIsFavorite ? 'var(--danger)' : '';
      };
    }

    // Функция закрытия деталей товара
    function closeProductDetail() {
      document.getElementById('productDetail').classList.remove('active');

      if (tg) {
        if (document.getElementById('homePage').classList.contains('active')) {
          tg.BackButton.hide();
        }
      }
    }

    // Функции для избранного
    function toggleFavorite(productId) {
      const index = favorites.indexOf(productId);

      if (index === -1) {
        favorites.push(productId);
        showNotification('Добавлено в избранное');
      } else {
        favorites.splice(index, 1);
        showNotification('Удалено из избранного');
      }

      localStorage.setItem('techstore_favorites', JSON.stringify(favorites));
      updateProfileStats();

      // Обновляем отображение на текущей странице
      if (document.getElementById('favoritesPage').classList.contains('active')) {
        renderFavorites();
      } else if (document.getElementById('homePage').classList.contains('active')) {
        renderProducts();
      }
    }

    // Функции корзины
    function addToCart(productId) {
      const product = products.find(p => p.id === productId);
      if (!product) return;

      const existingItem = cart.find(item => item.id === productId);

      if (existingItem) {
        existingItem.quantity += 1;
      } else {
        cart.push({
          ...product,
          quantity: 1
        });
      }

      updateCart();
      showNotification(`Добавлено: ${product.name}`);
    }

    function removeFromCart(productId) {
      cart = cart.filter(item => item.id !== productId);
      updateCart();
    }

    function updateQuantity(productId, change) {
      const item = cart.find(item => item.id === productId);
      if (item) {
        item.quantity += change;
        if (item.quantity <= 0) {
          removeFromCart(productId);
        } else {
          updateCart();
        }
      }
    }

    function updateCart() {
      localStorage.setItem('techstore_cart', JSON.stringify(cart));
      updateCartCount();
      renderCart();
      updateProfileStats();
    }

    function updateCartCount() {
      const count = cart.reduce((sum, item) => sum + item.quantity, 0);
      document.getElementById('cartCount').textContent = count;
      document.getElementById('detailCartCount').textContent = count;
    }

    function renderCart() {
      const cartItems = document.getElementById('cartItems');
      cartItems.innerHTML = '';

      if (cart.length === 0) {
        cartItems.innerHTML = `
          <div style="text-align: center; padding: 40px 20px; color: var(--tg-theme-hint-color);">
            <i class="fas fa-shopping-cart" style="font-size: 3rem; margin-bottom: 20px;"></i>
            <p>Ваша корзина пуста</p>
          </div>
        `;

        document.getElementById('subtotal').textContent = '0 ₽';
        document.getElementById('total').textContent = '0 ₽';
        return;
      }

      let subtotal = 0;

      cart.forEach(item => {
        const itemTotal = item.price * item.quantity;
        subtotal += itemTotal;

        const cartItem = document.createElement('div');
        cartItem.className = 'cart-item';
        cartItem.innerHTML = `
          <div class="cart-item-image">
            <img src="${item.image}" alt="${item.name}">
          </div>
          <div class="cart-item-content">
            <h4 class="cart-item-title">${item.name}</h4>
            <div class="cart-item-price">${item.price.toLocaleString()} ₽</div>
            <div class="cart-item-actions">
              <button class="quantity-btn" data-id="${item.id}" data-change="-1">-</button>
              <span class="quantity">${item.quantity}</span>
              <button class="quantity-btn" data-id="${item.id}" data-change="1">+</button>
              <button style="margin-left: auto; background: none; border: none; color: #ef4444;"
                      data-id="${item.id}" class="remove-btn">
                <i class="fas fa-trash"></i>
              </button>
            </div>
          </div>
        `;

        cartItems.appendChild(cartItem);
      });

      document.getElementById('subtotal').textContent = `${subtotal.toLocaleString()} ₽`;
      document.getElementById('total').textContent = `${subtotal.toLocaleString()} ₽`;

      // Добавляем обработчики для кнопок в корзине
      document.querySelectorAll('.quantity-btn').forEach(btn => {
        btn.addEventListener('click', (e) => {
          const productId = parseInt(btn.dataset.id);
          const change = parseInt(btn.dataset.change);
          updateQuantity(productId, change);
        });
      });

      document.querySelectorAll('.remove-btn').forEach(btn => {
        btn.addEventListener('click', (e) => {
          const productId = parseInt(btn.dataset.id);
          removeFromCart(productId);
        });
      });
    }

    function openCart() {
      document.getElementById('cartPanel').classList.add('active');

      if (tg) {
        tg.BackButton.show();
      }
    }

    function closeCart() {
      document.getElementById('cartPanel').classList.remove('active');

      if (tg) {
        if (document.getElementById('homePage').classList.contains('active')) {
          tg.BackButton.hide();
        }
      }
    }

    function showNotification(message) {
      if (tg && tg.showPopup) {
        tg.showPopup({
          title: 'Уведомление',
          message: message,
          buttons: [{ type: 'ok' }]
        });
      } else {
        // Fallback для браузера
        const notification = document.createElement('div');
        notification.style.cssText = `
          position: fixed;
          top: 20px;
          left: 50%;
          transform: translateX(-50%);
          background: var(--primary);
          color: white;
          padding: 12px 24px;
          border-radius: 12px;
          z-index: 9999;
          animation: fadeIn 0.3s ease;
          box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        `;
        notification.textContent = message;
        document.body.appendChild(notification);

        setTimeout(() => {
          notification.style.opacity = '0';
          notification.style.transform = 'translateX(-50%) translateY(-20px)';
          setTimeout(() => notification.remove(), 300);
        }, 2000);
      }
    }

    // Обработчики событий
    document.addEventListener('DOMContentLoaded', () => {
      // Инициализация
      renderProducts();
      renderCart();
      updateProfileStats();

      // Логотип как кнопка домой
      document.getElementById('homeButton').addEventListener('click', () => {
        showPage('home');
      });

      // Категории
      document.querySelectorAll('.category-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          document.querySelectorAll('.category-btn').forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          currentCategory = btn.dataset.category;
          renderProducts();
        });
      });

      // Кнопки избранного и профиля в шапке
      document.getElementById('favoritesButton').addEventListener('click', () => {
        showPage('favorites');
      });

      document.getElementById('profileButton').addEventListener('click', () => {
        showPage('profile');
      });

      // Корзина
      document.getElementById('cartButton').addEventListener('click', openCart);
      document.getElementById('detailCartButton').addEventListener('click', openCart);
      document.getElementById('closeCartButton').addEventListener('click', closeCart);

      // Назад
      document.getElementById('backButton').addEventListener('click', closeProductDetail);

      // Оформление заказа
      document.getElementById('checkoutButton').addEventListener('click', () => {
        if (cart.length === 0) {
          showNotification('Добавьте товары в корзину');
          return;
        }

        showNotification('Заказ оформлен! Скоро с вами свяжется менеджер.');
        cart = [];
        updateCart();
        closeCart();
      });

      // Нижнее меню
      document.querySelectorAll('.nav-item').forEach(item => {
        item.addEventListener('click', (e) => {
          e.preventDefault();
          const page = item.dataset.page;
          showPage(page);
        });
      });

      // Кнопка "Перейти в магазин" в пустом избранном
      document.getElementById('goToHomeFromFav').addEventListener('click', () => {
        showPage('home');
      });

      // Меню профиля
      document.getElementById('ordersMenuItem').addEventListener('click', () => {
        showNotification('Раздел "Мои заказы" в разработке');
      });

      document.getElementById('addressesMenuItem').addEventListener('click', () => {
        showNotification('Раздел "Адреса доставки" в разработке');
      });

      document.getElementById('paymentMenuItem').addEventListener('click', () => {
        showNotification('Раздел "Способы оплаты" в разработке');
      });

      document.getElementById('settingsMenuItem').addEventListener('click', () => {
        showNotification('Раздел "Настройки" в разработке');
      });

      document.getElementById('supportMenuItem').addEventListener('click', () => {
        showNotification('Раздел "Поддержка" в разработке');
      });
    });
  </script>
</body>
</html>